<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sentinela STP - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        :root { --sat: env(safe-area-inset-top, 0px); --sab: env(safe-area-inset-bottom, 0px); }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; padding-bottom: calc(5rem + var(--sab)); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6 bg-slate-900">

    <div class="w-full max-w-sm bg-white rounded-3xl p-8 shadow-2xl">
        <div class="text-center space-y-2 mb-8">
            <div class="bg-blue-100 w-12 h-12 rounded-2xl flex items-center justify-center mx-auto mb-4 text-blue-700">
                <i data-lucide="lock" size="24"></i>
            </div>
            <h1 class="text-2xl font-black text-slate-900 tracking-tight">Acesso Restrito</h1>
            <p class="text-sm text-slate-500 font-medium">Identifique-se para acessar o painel administrativo.</p>
        </div>

        <form id="login-form" class="space-y-4">
            <div class="space-y-1">
                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">E-mail</label>
                <div class="relative">
                    <i data-lucide="mail" size="16" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="email" id="email" required placeholder="seu@email.com" 
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl pl-10 pr-4 py-3 text-sm font-medium text-slate-800 outline-none focus:ring-2 focus:ring-blue-600 transition-all placeholder:text-slate-300">
                </div>
            </div>

            <div class="space-y-1">
                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">Senha</label>
                <div class="relative">
                    <i data-lucide="key" size="16" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="password" id="password" required placeholder="••••••••" 
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl pl-10 pr-4 py-3 text-sm font-medium text-slate-800 outline-none focus:ring-2 focus:ring-blue-600 transition-all placeholder:text-slate-300">
                </div>
            </div>

            <div id="error-message" class="text-red-500 text-xs font-bold text-center hidden"></div>

            <button type="submit" id="submit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black uppercase text-xs tracking-widest py-4 rounded-xl shadow-lg shadow-blue-200 active:scale-95 transition-all flex items-center justify-center gap-2 mt-6">
                Entrar no Sistema
                <i data-lucide="arrow-right" size="16"></i>
            </button>
        </form>
        
        <div class="mt-8 text-center">
            <a href="index.html" class="text-xs text-slate-400 hover:text-slate-600 font-bold transition-colors">Voltar para Início</a>
        </div>
    </div>

    <script>
        lucide.createIcons();
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBwXw-f03A0mEfw3-RHc5A-1paido_ZDhM",
          authDomain: "sentinela-stp.firebaseapp.com",
          projectId: "sentinela-stp",
          storageBucket: "sentinela-stp.firebasestorage.app",
          messagingSenderId: "845865605498",
          appId: "1:845865605498:web:f4823825b7114d08dcdec3",
          measurementId: "G-6DT4QG0RVT"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Forçar persistência de SESSÃO (ao fechar aba, desloga)
        setPersistence(auth, browserSessionPersistence)
            .then(() => {
                console.log("Persistência de sessão configurada: browserSessionPersistence");
            })
            .catch((error) => {
                console.error("Erro ao configurar persistência:", error);
            });

        const loginForm = document.getElementById('login-form');
        const errorMessage = document.getElementById('error-message');
        const submitBtn = document.getElementById('submit-btn');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Loading state
            const originalBtnContent = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<i data-lucide="loader-2" class="animate-spin" size="16"></i> Verificando...`;
            lucide.createIcons();
            errorMessage.classList.add('hidden');

            try {
                await signInWithEmailAndPassword(auth, email, password);
                // Redirecionar para admin
                window.location.href = 'admin-news.html';
            } catch (error) {
                console.error("Erro no login:", error);
                errorMessage.textContent = "E-mail ou senha inválidos. Tente novamente.";
                errorMessage.classList.remove('hidden');
                
                // Reset button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnContent;
                lucide.createIcons();
            }
        });
    </script>
    <script src="version-display.js"></script>
</body>
</html>